<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ - Ø²Ø§Ø¯ Ø§Ù„Ø±Ø­ÙŠÙ„</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; direction: rtl; background: #f9f9f9; padding: 0; margin: 0; }
    .container { max-width: 800px; margin: 40px auto; background: #fff; padding: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-radius: 15px; }
    h2 { color: #00796b; text-align: center; margin-bottom: 20px; }
    p, label { font-size: 16px; margin: 10px 0 5px; }
    select, input, button { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px; }
    input[type="radio"] { margin-left: 10px; }
    .section { display: none; }
    .active { display: block; }
    .age-group { display: flex; gap: 10px; }
    .age-group input { flex: 1; }
    button { background: #00796b; color: #fff; cursor: pointer; transition: .3s; }
    button:hover { background: #004d40; }
  </style>
</head>
<body>
<div class="container">

  <!-- â— Step 1: Main form -->
  <form class="section active" id="formSection">
    <h2>ğŸ“‹ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h2>
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„:</label><input type="text" name="firstName" required />
    <label>Ø§Ù„ÙƒÙ†ÙŠØ©:</label><input type="text" name="lastName" required />
    <label>Ø§Ù„Ø¬Ù†Ø³:</label><select name="gender" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option><option>Ø°ÙƒØ±</option><option>Ø£Ù†Ø«Ù‰</option>
    </select>
    <label>Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©:</label><input type="text" name="country" required />
    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ø§Ù„ÙŠÙˆÙ…-Ø§Ù„Ø´Ù‡Ø±-Ø§Ù„Ø³Ù†Ø©):</label>
    <div class="age-group">
      <input type="number" name="ageDay" placeholder="Ø§Ù„ÙŠÙˆÙ…" min="1" max="31" required />
      <input type="number" name="ageMonth" placeholder="Ø§Ù„Ø´Ù‡Ø±" min="1" max="12" required />
      <input type="number" name="ageYear" placeholder="Ø§Ù„Ø³Ù†Ø©" min="1950" max="2025" required />
    </div>
    <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
    <select name="grade" required><option value="">Ø§Ø®ØªØ±</option>
      <option>Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠ</option><option>Ø§Ù„Ø«Ø§Ù„Ø«</option><option>Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
      <option>Ø§Ù„Ø®Ø§Ù…Ø³</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³</option><option>Ø§Ù„Ø³Ø§Ø¨Ø¹</option><option>Ø§Ù„Ø«Ø§Ù…Ù†</option>
      <option>Ø§Ù„ØªØ§Ø³Ø¹</option><option>Ø§Ù„Ø¹Ø§Ø´Ø±</option><option>Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</option><option>Ø§Ù„Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§</option><option>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</option>
    </select>
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©):</label><input type="tel" name="phone" required />
    <button type="button" onclick="showNotes()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </form>

  <!-- â— Step 2: Notes & Payment -->
  <div class="section" id="notesSection">
    <h2>ğŸ“Œ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù‡Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø©</h2>
    <p><strong>Ø£ÙˆÙ„Ø§Ù‹ â€“ Ø±Ø³ÙˆÙ… Ø§Ù„Ø¯ÙˆØ±Ø©:</strong><br>
      ... (Ø§Ù„Ù†Øµ Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ ØªØ±ÙŠØ¯) ...
    </p>
    <p><strong>Ø«Ø§Ù†ÙŠÙ‹Ø§ â€“ Ø­ÙŠØ§Ø¯ÙŠØ© Ø§Ù„Ù…Ø´Ø§ÙŠØ®:</strong> ...</p>
    <p><strong>Ø«Ø§Ù„Ø«Ù‹Ø§ â€“ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙˆØ§Ù„Ø¬ÙˆØ§Ø¦Ø²:</strong> ...</p>
    <p><strong>Ø±Ø§Ø¨Ø¹Ù‹Ø§ â€“ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> ...</p>
    <p><strong>ğŸ’° ÙƒÙ… ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ù‡ØŸ</strong></p>
    <label><input type="radio" name="paymentChoice" value="10+"> Ø£Ø±ÙŠØ¯ Ø¯ÙØ¹ 10$ + ØªØ¨Ø±Ø¹ Ø¥Ø¶Ø§ÙÙŠ</label><br>
    <label><input type="radio" name="paymentChoice" value="10"> Ø£Ø±ÙŠØ¯ Ø¯ÙØ¹ 10$ ÙÙ‚Ø· Ù„Ù„Ø´Ù‡Ø§Ø¯Ø©</label><br>
    <label><input type="radio" name="paymentChoice" value="5"> Ø£Ø±ÙŠØ¯ Ø¯ÙØ¹ 5$ ÙÙ‚Ø· Ù„Ù„Ø´Ù‡Ø§Ø¯Ø©</label><br>
    <label><input type="radio" name="paymentChoice" value="0"> Ø£Ø±ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ù…Ø¬Ø§Ù†Ù‹Ø§ØŒ ÙˆÙ„Ø§ Ø£Ø±ÙŠØ¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</label><br>
    <button onclick="handlePaymentChoice()">Ù„Ù‚Ø¯ ÙÙ‡Ù…ØªØŒ Ø´ÙƒØ±Ù‹Ø§</button>
  </div>

  <!-- â— Step 3: Phone Verification -->
  <div class="section" id="verifySection">
    <h2>ğŸ” Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</h2>
    <button type="button" onclick="sendCode()">ğŸ“© Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</button>
    <div id="codeArea" style="display:none">
      <label>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚:</label><input type="text" id="enteredCode" maxlength="6" />
      <button onclick="verifyCode()">âœ… ØªØ­Ù‚Ù‚</button>
    </div>
  </div>

</div>

<script>
  let userData = {};
  let correctCode = '';

  function showNotes() {
    const form = document.getElementById('formSection');
    if (!form.checkValidity()) return form.reportValidity();
    userData = Object.fromEntries(new FormData(form));
    switchTo('notesSection');
  }

  function switchTo(id) {
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function generateCode(phone) {
    const last6 = phone.slice(-6), codeArr = [...last6].map(d => +d === 0 ? '0' : (+d -1));
    return codeArr.join('');
  }

  async function sendWhatsApp(phone, message) {
    const inst = "instance129389", tok = "9grguvsi1pp4buyr";
    await fetch(`https://api.ultramsg.com/${inst}/messages/chat?token=${tok}`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({to: phone, body: message})
    });
  }

  function handlePaymentChoice() {
    const sel = document.querySelector('input[name="paymentChoice"]:checked');
    if (!sel) return alert("Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª");
    userData.payment = sel.value;

    if (sel.value === '0') {
      sendWhatsApp(userData.phone,
        `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${userData.firstName} ${userData.lastName}ØŒ\nØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ù…Ø¬Ø§Ù†Ù‹Ø§ ÙÙŠ Ø¯ÙˆØ±Ø© Ø²Ø§Ø¯ Ø§Ù„Ø±Ø­ÙŠÙ„ Ø¶Ù…Ù†: ${userData.grade}\nØ´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆÙ†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø§Ù„ØªÙˆÙÙŠÙ‚.`);
      alert("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¬Ø§Ù†Ù‹Ø§. ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯.");
      return;
    }

    correctCode = generateCode(userData.phone);
    switchTo('verifySection');
  }

  function sendCode() {
    correctCode = generateCode(userData.phone);
    sendWhatsApp(userData.phone, `ğŸ” ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ùˆ: ${correctCode}`);
    document.getElementById('codeArea').style.display = 'block';
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.");
  }

  function verifyCode() {
    if (document.getElementById('enteredCode').value.trim() !== correctCode)
      return alert("âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­");

    sendWhatsApp(userData.phone,
      `âœ… Ù…Ø±Ø­Ø¨Ù‹Ø§ ${userData.firstName} ${userData.lastName}ØŒ\nØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø¯ÙˆØ±Ø© Ø²Ø§Ø¯ Ø§Ù„Ø±Ø­ÙŠÙ„ Ø¶Ù…Ù†: ${userData.grade}\nØ´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆÙ†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø§Ù„ØªÙˆÙÙŠÙ‚.`);
    alert("ğŸ‰ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚. ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.");
  }
</script>
</body>
</html>
